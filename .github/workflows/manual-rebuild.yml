name: Manual Pages Rebuild

on:
  workflow_dispatch:
    inputs:
      clean_build:
        description: '–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–Ω—É—é –æ—á–∏—Å—Ç–∫—É'
        required: true
        default: 'true'

jobs:
  rebuild:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Create and clean gh-pages branch
        if: ${{ github.event.inputs.clean_build == 'true' }}
        run: |
          git checkout --orphan gh-pages || git checkout gh-pages
          git rm -rf .
          git clean -fdx
          
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '22'
          
      - name: Install dependencies
        run: |
          npm install -g pnpm
          pnpm i
    
      - name: Building pages
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "${{ github.actor }}"
          git config --global user.email "${{ github.actor }}@users.noreply.github.com"
          git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git
          pnpm gh-pages -d dist -b gh-pages

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist


      - name: Send Telegram notification
        if: always()
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            üöÄ –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π
            –°—Ç–∞—Ç—É—Å: ${{ job.status != 'success' && '‚ùå –û—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –¥–µ–ø–ª–æ—è' || '‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω!' }}

            –í–µ—Ç–∫–∞: ${{ github.ref_name }} || https://github.com/${{ github.repository }}/tree/${{ github.ref_name }}
            –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–º–º–∏—Ç: https://github.com/${{ github.repository }}/commit/${{ github.sha }}
            –ê–≤—Ç–æ—Ä –∫–æ–º–º–∏—Ç–∞: ${{ github.actor }}
            –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://github.com/${{ github.repository }}
            
            –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å: https://vovmomyt.github.io/valentine